!function(){function e(t){var n=e.modules[t];if(!n)throw new Error('failed to require "'+t+'"');return"exports"in n||"function"!=typeof n.definition||(n.client=n.component=!0,n.definition.call(this,n.exports={},n),delete n.definition),n.exports}e.modules={},e.register=function(t,n){e.modules[t]={definition:n}},e.define=function(t,n){e.modules[t]={exports:n}},e.register("med",function(t,n){"use strict";function r(e){i.call(this),a.call(this),o.call(this),c.call(this),u.call(this),this.options=l.mixin(Object.create(d),e||{}),this.context={},this.context.editor=this;var t=this.options.el;t||(t=document.createElement("div")),t.setAttribute("contenteditable",!0),t.classList.add("med"),this.el=t,this.caret=new s(this),this.bindEvents(),this.handleEmpty(),this.use(p.initContext()),p.removeExtraNodes(this),p.renameElements(this),p.removeInlineStyle(this),p.handleEmptyParagraph(this),p.refocus(this)}n.exports=r;var i=e("med/src/emitter.js"),s=e("med/src/caret.js"),a=e("med/src/mixin/middleware.js"),o=e("med/src/mixin/observe.js"),c=e("med/src/mixin/html-builder.js"),u=e("med/src/mixin/figure.js"),l=e("med/src/utils/index.js"),p=e("med/src/plugins/index.js"),d=e("med/src/default-options.js");r.prototype=Object.create(i.prototype),l.mixin(r.prototype,a.prototype),l.mixin(r.prototype,o.prototype),l.mixin(r.prototype,c.prototype),l.mixin(r.prototype,u.prototype),r.prototype.start=function(){return this.compose([p.preventDefault(),p.commandA(this),p.handleParagraph(this),p.handleList(this),p.handleFigure(this),p.handleBlockquote(this),p.handleBackspace(this)])},r.prototype.end=function(){return this.compose([p.createNewParagraph()])},r.prototype.bindEvents=function(){var e=this.el,t=e.addEventListener.bind(e);t("keydown",this.onKeydown.bind(this)),t("keyup",this.handleEmpty.bind(this)),t("blur",this.handleEmpty.bind(this)),t("focus",this.handleEmpty.bind(this))},r.prototype.onKeydown=function(e){var t;this.handleEmpty(),t=Object.create(this.context),t.event=e,t.prevent=l.preventDefault.bind(null,e),this.exec(t,function(e){e&&this.emit("error",e)}.bind(this)),this.sync(),this.walk(),setTimeout(function(){this.sync()}.bind(this))},r.prototype.isEmpty=function(){var e=this.el.children,t=e[0];return e.length<=1&&!l.getTextContent(t).trim()},r.prototype.handleEmpty=function(){var e=this.el.children[0];if(!e){var t=document.createElement("p");e=document.createElement("section"),t.innerHTML='<br type="_med_placeholder">',e.appendChild(t),this.el.appendChild(e),this.sync(this.el),setTimeout(function(){this.caret.focusTo(t)}.bind(this))}this.isEmpty()?this.el.classList.add("is-empty"):this.el.classList.remove("is-empty")},r.prototype.walk=function(){var e=this.el.querySelectorAll("[name]"),t={editor:this};t.editor=this,this.emit("walkStart",t),Array.prototype.forEach.call(e,function(e){t.el=e,t.element=e,t.name=e.getAttribute("name"),t.data=this.data[t.name],this.emit("walk",t)}.bind(this)),this.emit("walkEnd",t)}}),e.register("med/src/caret.js",function(t,n){"use strict";function r(e){this.editor=e}var i=e("med/src/utils/index.js");n.exports=r,r.prototype.focusNode=function(){return document.getSelection().focusNode},r.prototype.focusElement=function(e){var t;if(e){for(t=this.focusElement(),e=e.toUpperCase();t&&t.tagName!==e;)t=t.parentElement;return t&&t.tagName===e?t:null}for(t=document.getSelection().focusNode;t&&!i.isElementNode(t);)t=t.parentNode;return t},r.prototype.focusSection=function(){return this.focusType("section")},r.prototype.focusParagraph=function(){return this.focusType("paragraph")},r.prototype.focusParagraphs=function(){return this.focusType("paragraphs")},r.prototype.focusFigure=function(){return this.focusType("figure")},r.prototype.focusDetail=function(){return this.focusType("detail")},r.prototype.focusType=function(e){for(var t,n=this.focusElement();;){if(!n)break;if(t=i.getType(n),t===e)return n;n=n.parentElement}return null},r.prototype.nextElement=function(e){for(e?e=e.nextSibling:(e=this.focusNode(),e=e&&e.nextSibling);e;){if(i.isElementNode(e))return e;e=e.nextSibling}return null},r.prototype.focusTo=function(e){e&&(e.innerHTML.trim()?this.moveToStart(e):(e.innerHTML="￿",this.moveToStart(e),e.innerHTML=""))},r.prototype.textBefore=function(){var e=document.getSelection(),t=e.focusNode,n=e.focusOffset;return i.isElementNode(t)?"":t.substringData(0,n)},r.prototype.textAfter=function(){var e=document.getSelection(),t=e.focusNode,n=e.focusOffset;return i.isElementNode(t)?"":t.substringData(n,t.length-1)},r.prototype.moveToStart=function(e,t){if(e){var n,r=document.getSelection(),s=document.createRange();n=i.isTextNode(e)?i.getTextContent(e).length:e.childNodes.length,t=0|t,0>t?t=0:t>=n&&(t=n),s.setStart(e,t),s.setEnd(e,t),r.removeAllRanges(),r.addRange(s),r.collapseToStart()}},r.prototype.moveToEnd=function(e,t){if(e){var n,r=document.createRange(),s=window.getSelection();n=i.isTextNode(e)?i.getTextContent(e).length:e.childNodes.length,t=n-(0|t),0>t&&(t=0),r.setStart(e,t),r.setEnd(e,t),s.removeAllRanges(),s.addRange(r),s.collapseToEnd()}},r.prototype.split=function(e){if(!e)return null;var t=document.getSelection(),n=t.focusNode,r=t.focusOffset,i=document.createRange(),s=Array.prototype.indexOf.call(e.parentNode.childNodes,e);i.setStart(e.parentNode,s),i.setEnd(n,r);var a=i.extractContents();return e.parentNode.insertBefore(a,e),e},r.prototype.save=function(){var e,t=document.getSelection();t&&(t.rangeCount&&(e=t.getRangeAt(0)),this._range=e)},r.prototype.restore=function(){var e=this._range;if(e){var t=document.createRange(),n=document.getSelection();t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset),n.removeAllRanges(),n.addRange(t)}},r.prototype.selectAllText=function(e){var t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)},r.prototype.selectAll=function(e){var t=i.firstTextNode(e),n=i.lastTextNode(e);this.select(t,n)},r.prototype.select=function(){var e,t,n,r,s,a=window.getSelection(),o=function(){e&&i.isEmpty(e)&&i.setNodeContent(e,"￿"),n&&i.isEmpty(n)&&i.setNodeContent(n,"￿")},c=function(){var t=i.getTextContent(e),r=i.getTextContent(n),s=/\uffff/g;t=t.replace(s,""),r=r.replace(s,""),i.setNodeContent(e,t),i.setNodeContent(n,r)};switch(arguments.length){case 1:e=n=arguments[0],t=0,r=i.getTextContent(e).length;break;case 2:"number"==typeof arguments[1]?(e=n=arguments[0],t=r=arguments[1],o()):(e=arguments[0],t=0,n=arguments[1],o(),r=i.getTextContent(n).length);break;case 3:e=arguments[0],n=arguments[1],o(),t=0,r=i.getTextContent(e).length;break;case 4:e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3],o()}t=0|t,r=0|r,s=document.createRange(),s.setStart(e,t),s.setEnd(n,r),a.removeAllRanges(),a.addRange(s),c()},r.prototype.insertElement=function(e){var t=document.getSelection(),n=t.getRangeAt(0);n.deleteContents(),n.insertNode(e)},r.prototype.closestElement=function(){var e=this.focusNode();return this.nextElement(e)},r.prototype.atElementStart=function(e){if(!e.childNodes.length)return!0;var t=document.getSelection(),n=t.focusNode,r=t.focusOffset,i=document.createRange();return i.setStart(e.childNodes[0],0),i.setEnd(n,r),!i.toString().trim()},r.prototype.atElementEnd=function(e){if(!e.childNodes.length)return!0;var t=document.getSelection(),n=t.focusNode,r=t.focusOffset,s=document.createRange(),a=i.lastTextNode(e);return a?(s.setStart(n,r),s.setEnd(a,a.length),!s.toString().trim()):!0}}),e.register("med/src/data.js",function(t,n){"use strict";function r(e){this.id=e,this.modified=!1,this.data={},this.tmp={}}var i=e("med/src/utils/index.js");n.exports=r,r.prototype.set=function(e,t){return i.equal(this.get(e),t)||(this.modified=!0),this.tmp[e]=t,this},r.prototype._set=function(e,t){for(var n=i.split(e,"."),r=n.pop(),s=this.data;e=n.shift();)s=void 0===s[e]?s[e]={}:s[e];return s[r]=t,this},r.prototype.get=function(e){if(this.tmp[e])return this.tmp[e];for(var t=i.split(e,"."),n=this.data;e=t.shift();){if(void 0===n)return;n=n[e]}return n},r.prototype.update=function(){var e=this.tmp;return Object.keys(e).forEach(function(t){this._set(t,e[t])}.bind(this)),this.modified=!1,this.tmp={},this},r.prototype.toJSON=function(){return i.clone(this.data)}}),e.register("med/src/default-options.js",function(e,t){"use strict";t.exports={genName:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";return e.replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}}}),e.register("med/src/emitter.js",function(e,t){"use strict";function n(){this.events={}}t.exports=n,n.prototype.on=function(e,t){var n=this.events[e]||[];return n.push(t),this.events[e]=n,this},n.prototype.once=function(e,t){return t._once=!0,this.on(e,t),this},n.prototype.off=function(e,t){if("function"==typeof e){t=e;for(e in this.events)this.events.hasOwnProperty(e)&&this.off(e,t);return this}for(var n=this.events[e],r=n.length;r--;)t===n[r]&&n.splice(r,1);return this},n.prototype.emit=function(){var e,t=Array.prototype.slice.call(arguments),n=t.shift(),r=this.events[n]||[],i=r.length;if("error"===n&&!i)throw t[0];for(;i--;)e=r[i],e.apply(this,t),e._once&&r.splice(i,1);return this}}),e.register("med/src/figure-type.js",function(e,t){"use strict";function n(e,t){this.options=t||(t={}),this.name=e}t.exports=n,n.prototype.updateData=function(e,t){t.set("figureType",this.name),this.options.updateData&&this.options.updateData(e,t)},n.prototype.updateHTML=function(e,t){e.setAttribute("type",this.name),this.options.updateHTML&&this.options.updateHTML(e,t)}}),e.register("med/src/keyboard.js",function(t,n){"use strict";var r=e("med/src/utils/index.js"),i=n.exports={};i.modifiers={224:"command",91:"command",93:"command",18:"alt",17:"ctrl",16:"shift"},i.map={8:"backspace",9:"tab",13:"enter",20:"capslock",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},i.super="mac"===r.os()?"command":"ctrl"}),e.register("med/src/schema.js",function(e,t){"use strict";var n=t.exports={section:{type:"section"},h1:{type:"paragraph",text:"content"},h2:{type:"paragraph",text:"content"},h3:{type:"paragraph",text:"content"},h4:{type:"paragraph",text:"content"},h5:{type:"paragraph",text:"content"},h6:{type:"paragraph",text:"content"},p:{type:"paragraph",text:"content"},blockquote:{type:"paragraph",text:"content",quoteTpye:"dataset:type"},figure:{type:"figure"},ol:{type:"paragraphs"},ul:{type:"paragraphs"},li:{type:"paragraph",text:"content"},a:{type:"detail",href:"attribute",title:"attribute"},b:{type:"detail"},i:{type:"detail"},br:{type:"detail"}};Object.keys(n).forEach(function(e){var t=n[e],r=t.type,i=[];delete t.type,Object.keys(t).forEach(function(e){var n=t[e],r=n.split(":"),s=r.shift();i.push({name:r[0]||e,type:s,args:r})}),n[e]={type:r,attrs:i}})}),e.register("med/src/mixin/figure.js",function(t,n){"use strict";function r(){this.figureTypes={},this.registerFigureType("default",{updateData:function(e,t){t.set("html",e.innerHTML)},updateHTML:function(e,t){e.innerHTML=t.get("html")}})}var i=e("med/src/figure-type.js"),s=e("med/src/utils/index.js");n.exports=r,r.prototype.registerFigureType=function(e,t){var n=new i(e,t);return this.figureTypes[e]=n,this},r.prototype.getFigureType=function(e){return s.isElementNode(e)&&(e=e.getAttribute("type")),this.figureTypes[e]||this.figureTypes.default}}),e.register("med/src/mixin/html-builder.js",function(t,n){"use strict";function r(){}var i=e("med/src/data.js"),s=e("med/src/schema.js"),a=e("med/src/utils/index.js");n.exports=r,r.prototype.fromJSON=function(e){r.importData.call(this,e),r.buildHTML.call(this)},r.importData=function(e){function t(e){var t=e.name,r=n[t]=new i(t);return delete e.name,r.data=e,r.update(),t}e=a.clone(e);var n=this.data={},r=this.structure={},s=r.sections=[],o=r.paragraphs=[];return(e.sections||[]).forEach(function(e){var t=e.name,r=n[t]=new i(t);delete e.name,r.data=e,r.update(),s.push(t)}),(e.paragraphs||[]).forEach(function(e){var r=e.name,s=n[r]=new i(r);delete e.name,s.data=e,"figure"!==s.get("type")&&(e.detail=(e.detail||[]).map(t)),s.update(),o.push(r)}),this},r.buildHTML=function(){var e=document.createDocumentFragment(),t=this.el,n="";r.createElements.call(this,e),a.each(e.childNodes,function(e){n+=e.outerHTML}),t.innerHTML=n},r.createElements=function(e){r.createSections.call(this,e)},r.createSections=function(e){var t=this.structure,n=this.data;t.sections.forEach(function(t){var i=n[t],s=r.createElement(i);r.createParagraphs.call(this,i,s),e.appendChild(s)}.bind(this))},r.createParagraphs=function(e,t){var n=this.structure,i=this.data;n.paragraphs.slice(e.get("start"),e.get("end")).forEach(function(e){var n=i[e],s=r.createElement(n),o=a.getType(s);"paragraphs"===o?r.createParagraphs.call(this,n,s):n.get("in-paragraphs")||(a.isType("figure",s)?r.createFigure.call(this,n,s):r.createDetails.call(this,n,s)),t.appendChild(s)}.bind(this))},r.createFigure=function(e,t){var n=this.getFigureType(e.get("type"));n.updateHTML(t,e)},r.createDetails=function(e,t){var n,i,s=this.data,a=e.get("detail"),o=e.get("text"),c=0;t.innerHTML="",a.forEach(function(e){var a=s[e],u=r.createElement(a),l=a.get("start"),p=a.get("end");c!==l&&(n=o.slice(c,l),i=document.createTextNode(n),t.appendChild(i)),u.innerHTML=o.slice(l,p),t.appendChild(u),c=p}),c!==o.length&&(n=o.slice(c,o.length),i=document.createTextNode(n),t.appendChild(i))},r.createElement=function(e){var t=e.get("tag"),n=document.createElement(t);return n.setAttribute("name",e.id),r.initElement(n,e),n},r.initElement=function(e,t){var n=s[t.get("tag")];n.attrs.forEach(function(n){r[n.type](e,t,n)})},r.attribute=function(e,t,n){e.setAttribute(n.name,t.get(n.name))},r.dataset=function(e,t,n){e.setAttribute("data-"+n.name,t.get(n.name))},r.content=function(e,t,n){void 0===e.textContent?e.innerText=t.get(n.name):e.textContent=t.get(n.name)}}),e.register("med/src/mixin/middleware.js",function(e,t){"use strict";function n(){this.middleware=[]}t.exports=n,n.prototype.use=function(e){if("function"!=typeof e)throw new Error("The first argument must me a function.");return this.middleware.push(e),this},n.prototype.exec=function(e,t){var n=this.compose(this.middleware);n.call(e,t)},n.prototype.compose=function(e){return function(t){var n=0,r=function(i){if(i)return t(i);var s=e[n++];if(!s)return t();try{s.call(this,r)}catch(a){t(a)}}.bind(this);r()}}}),e.register("med/src/mixin/observe.js",function(t,n){"use strict";function r(){this.structure=null,this.data={}}var i=e("med/src/data.js"),s=e("med/src/utils/index.js"),a=e("med/src/schema.js");n.exports=r,r.prototype.sync=function(){var e={paragraphs:[],sections:[]},t=this.data,n={},i={structure:e,shouldBeDelete:n};Object.keys(t).forEach(function(e){n[e]=1}),s.each(this.el.children,function(e){r.scan.call(this,i,e)}.bind(this)),Object.keys(n).forEach(function(e){delete t[e]}),this.structure=e},r.scan=function(e,t){var n=t.tagName.toLowerCase(),s=t.getAttribute("name"),o=this.data[s],c=a[n];return c?(r.checkAndRemoveStrangeElement.call(this,t),s&&delete e.shouldBeDelete[s],o||(s||(s=this.options.genName()),o=new i(s),o.set("tag",n),this.data[s]=o,t.setAttribute("name",o.id)),r[c.type].call(this,e,t,o),c.attrs.forEach(function(e){r[e.type].call(this,t,o,e)}.bind(this)),o.modified&&(o.update(),this.emit("changed",o)),o):void t.parentElement.removeChild(t)},r.section=function(e,t,n){var i=e.structure,a=[];s.each(t.children,function(t){var o=s.getElementSchema(t);return o?(~i.sections.indexOf(n.id)||i.sections.push(n.id),void(/^(paragraphs?|figure)$/.test(o.type)&&a.push(r.scan.call(this,e,t).id))):void r.handleUnknownElement(t)}.bind(this)),n.set("start",i.paragraphs.length),n.set("end",Array.prototype.push.apply(i.paragraphs,a))},r.paragraphs=function(e,t,n){var i=e.structure,a=[];s.each(t.children,function(t){var n=s.getElementSchema(t);return n?void("paragraph"===n.type&&a.push(r.scan.call(this,e,t).id)):void r.handleUnknownElement(t)}.bind(this)),n.set("start",i.paragraphs.length),n.set("end",Array.prototype.push.apply(i.paragraphs,a))},r.figure=function(e,t,n){var r=this.getFigureType(t);r.updateData(t,n)},r.paragraph=function(e,t,n){var i=[];s.each(t.children,function(t){var n=s.getElementSchema(t);return n?void("detail"===n.type&&i.push(r.scan.call(this,e,t).id)):void r.handleUnknownElement(t)}.bind(this)),n.set("detail",i)},r.detail=function(e,t,n){var i=r.getOffset(t);n.set("start",i.start),n.set("end",i.end)},r.attribute=function(e,t,n){var r=e.getAttribute(n.name);t.set(n.name,r)},r.dataset=function(e,t,n){var r=e.getAttribute("data-"+n.name);t.set(n.name,r)},r.content=function(e,t,n){var r=s.getTextContent(e);t.set(n.name,r)},r.handleUnknownElement=function(e){var t=s.getTextContent(e),n=document.createTextNode(t);e.parentElement.replaceChild(n,e)},r.getOffset=function(e){for(var t,n,r,i=e.parentNode,a={start:0,end:0},o=function(){return i&&s.isElementNode(i)&&!i.getAttribute("name")};o();)i=i.parentElement;return i&&(r=document.createElement("div"),a.start=i.innerHTML.indexOf(e.outerHTML),t=i.innerHTML.substr(0,a.start),r.innerHTML=t,n=s.getTextContent(r),a.start-=t.length-n.length,a.end=a.start+s.getTextContent(e).length),a},r.prototype.toJSON=function(){function e(e){var t=i[e],n=t&&t.toJSON()||{};return n.name=e,n}this.structure||this.sync();var t=this.structure,n=t.sections,r=t.paragraphs,i=this.data,s={sections:[],paragraphs:[]};return n.forEach(function(e){var t=i[e],n=t&&t.toJSON()||{};n.name=e,s.sections.push(n)}),r.forEach(function(t){var n=i[t],r=n&&n.toJSON()||{};r.name=t,r.detail=(r.detail||[]).map(e),s.paragraphs.push(r)}),s},r.rules={section:{paragraph:1,paragraphs:1,figure:1},paragraphs:{paragraph:1},paragraph:{detail:1},detail:{}},r.checkAndRemoveStrangeElement=function(e){var t=s.getType(e),n=s.getType(e.parentElement),i=!0;t&&n?r.rules[n][t]&&(i=!1):e.parentElement===this.el&&"section"===t&&(i=!1),i&&e.parentElement.removeChild(e)}}),e.register("med/src/plugins/index.js",function(t,n){"use strict";var r=n.exports={};r.commandA=e("med/src/plugins/command-a.js"),r.preventDefault=e("med/src/plugins/prevent-default.js"),r.createNewParagraph=e("med/src/plugins/create-new-paragraph.js"),r.handleBackspace=e("med/src/plugins/handle-backspace.js"),r.handleBlockquote=e("med/src/plugins/handle-blockquote.js"),r.handleEmptyParagraph=e("med/src/plugins/handle-empty-paragraph.js"),r.handleFigure=e("med/src/plugins/handle-figure.js"),r.handleList=e("med/src/plugins/handle-list.js"),r.handleParagraph=e("med/src/plugins/handle-paragraph.js"),r.initContext=e("med/src/plugins/init-context.js"),r.refocus=e("med/src/plugins/refocus.js"),r.removeExtraNodes=e("med/src/plugins/remove-extra-nodes.js"),r.removeInlineStyle=e("med/src/plugins/remove-inline-style.js"),r.renameElements=e("med/src/plugins/rename-elements.js")}),e.register("med/src/plugins/command-a.js",function(e,t){"use strict";t.exports=function(e){return function(t){this.super&&"a"===this.key.toLowerCase()?(this.prevent(),e.caret.selectAll(e.el)):t()}}}),e.register("med/src/plugins/prevent-default.js",function(e,t){"use strict";t.exports=function(){return function(e){var t=this.element;return"backspace"===this.key&&this.editor.isEmpty()?void this.prevent():~[document.body,this.section].indexOf(t)?void this.prevent():void e()}}}),e.register("med/src/plugins/create-new-paragraph.js",function(t,n){"use strict";var r=e("med/src/utils/index.js");n.exports=function(){return function(e){var t="enter"===this.key&&this.section===this.editor.caret.focusSection()&&!this.shift&&r.isTag("p",this.element)&&this.element.parentElement&&this.editor.caret.atElementEnd(this.element);if(t){this.prevent();var n=document.createElement("p");this.element.parentElement.insertBefore(n,this.element.nextSibling),this.editor.caret.focusTo(n)}e()}}}),e.register("med/src/plugins/handle-backspace.js",function(t,n){"use strict";var r=e("med/src/utils/index.js");n.exports=function(e){var t=function(t){var n=document.getSelection(),i=t.paragraph;return!(n+"")&&r.isType(["paragraph","paragraphs","section"],i)&&e.caret.atElementStart(i)},n=function(t){var n=t.paragraph,i=t.paragraphs;if(i&&r.isFirstElementOf(i,n)){t.prevent();var s=document.createElement("p");r.moveChildNodes(n,s),r.removeElement(n),t.section.insertBefore(s,i),r.isEmpty(i)&&r.removeElement(i),e.caret.moveToStart(s)}},i=function(t){t.prevent();var n,i,s,a,o=t.paragraph,c=o.previousElementSibling;if(n=c?o:t.section,c=n.previousElementSibling,n&&c)if(r.isType("paragraphs",c)){if(c.lastChild&&r.isTag("li",c.lastChild)){var u=c.lastChild.lastChild;r.moveChildNodes(o,c.lastChild),r.removeElement(o),u?e.caret.moveToEnd(u):e.caret.moveToStart(c.lastChild)}}else s=n.firstChild,a=c.childNodes[c.childNodes.length-1],i=r.getTextContent(a).length,r.isElementNode(a)&&r.isTag("br",a)&&(r.removeElement(a),a=null),r.removeEmptyElements(c),r.moveChildNodes(n,c),n.parentElement.removeChild(n),r.isType("section",n)?e.caret.focusTo(s):a?e.caret.moveToStart(a,i):e.caret.moveToStart(c);else{c=t.node.previousSibling;var l=function(){return c&&r.isElementNode(c)&&r.isTag("br",c)};l()&&(i=r.getTextContent(c.previousSibling).length,c.parentElement.removeChild(c),e.caret.moveToStart(t.node.previousSibling,i))}},s=function(){var t=e.caret.focusParagraphs(),n=t&&t.nextElementSibling;return n&&n.tagName===t.tagName},a=function(){var t=e.caret.focusParagraphs(),n=t.nextElementSibling;r.moveChildNodes(n,t),r.removeElement(n)};return function(o){if("backspace"!==this.key)return o();var c=this.paragraph;if(t(this))r.isTag("li",c)?n(this,o):i(this,o);else if(this.figure){this.prevent();var u=this.figure.previousElementSibling;r.removeElement(this.figure),e.caret.moveToEnd(u)}s()&&a(),o()}}}),e.register("med/src/plugins/handle-blockquote.js",function(t,n){"use strict";var r=e("med/src/utils/index.js");n.exports=function(e){return function(t){var n=this.paragraph;if(!r.isTag("blockquote",n))return t();if("enter"!==this.key||this.shift)return t();if(this.prevent(),e.caret.atElementEnd(n)){var i=document.createElement("p");i.innerHTML="<br />",this.section.insertBefore(i,n.nextSibling),e.caret.moveToStart(i)}else if(e.caret.atElementStart(n)){var s=document.createElement("blockquote");s.innerHTML="<br />",this.section.insertBefore(s,n)}else e.caret.split(n);t()}}}),e.register("med/src/plugins/handle-empty-paragraph.js",function(t,n){"use strict";var r=e("med/src/utils/index.js");n.exports=function(e){e.on("walk",function(e){var t=e.element;t.innerHTML.trim()||(r.isType("paragraph",t)?t.innerHTML='<br type="_med_placeholder" />':r.isType("section",t)&&(t.innerHTML='<p><br type="_med_placeholder" /></p>'))})}}),e.register("med/src/plugins/handle-figure.js",function(t,n){"use strict";var r=e("med/src/utils/index.js");n.exports=function(e){var t="is-active",n=function(n){var r=e.el.querySelector("figure.is-active");r&&r!==n&&r.classList.remove(t)};return e.on("walkEnd",function(){var r=e.caret.focusFigure();r&&r.classList.add(t),n(r)}),e.el.addEventListener("mousedown",function(i){var s=i.target;for(r.isAncestorOf(e.caret.focusNode(),e.el)||e.caret.moveToStart(s);;){if(!s||s===e.el){s=null;break}if(r.isTag("figure",s))break;s=s.parentElement}s&&s.classList.add(t),n(s)}),e.el.addEventListener("blur",function(){n()}),function(e){e()}}}),e.register("med/src/plugins/handle-list.js",function(t,n){"use strict";var r=e("med/src/utils/index.js");n.exports=function(e){var t=function(t){t.prevent();var n=t.paragraph,i=document.createElement("p");i.innerHTML="<br />",r.isLastElementOf(t.paragraphs,n)?(t.section.insertBefore(i,t.paragraphs.nextSibling),r.removeElement(n)):(r.removeElement(n),e.caret.split(t.paragraphs),t.section.insertBefore(i,t.paragraphs)),e.caret.moveToStart(i)},n=function(t){var n=t.paragraph,i=document.createElement("p");i.innerHTML=n.innerHTML,r.removeElement(n),t.section.insertBefore(i,t.paragraphs.nextSibling),e.caret.moveToStart(i)};return function(i){var s=this.paragraph;return r.isTag("li",s)?("enter"!==this.key||this.shift||(r.isEmpty(s)?t(this):e.caret.atElementEnd(s)?(this.prevent(),e.caret.split(s)):e.caret.atElementStart(s)&&r.isLastElementOf(this.paragraphs,s)&&(this.prevent(),n(this))),void i()):i()}}}),e.register("med/src/plugins/handle-paragraph.js",function(t,n){"use strict";var r=e("med/src/utils/index.js"),i=function(e){return!e.modifier&&r.isTag("p",e.paragraph)&&s(e)},s=function(e){return"enter"===e.key&&!e.shift},a=function(e,t){var n=e.editor,i=e.paragraph;if(r.isEmpty(i)){e.prevent();var s=e.section;if(s){if(r.isNotEmpty(s)){var a;r.removeEmptyElements(s),n.caret.split(s),a=document.createElement("p"),a.innerHTML="<br />",s.insertBefore(a,s.firstChild),n.caret.moveToStart(a),t()}}else s=document.createElement("section"),s.appendChild(i),n.el.appendChild(s),n.caret.moveToStart(i),t()}else n.caret.atElementStart(i)&&(e.prevent(),n.caret.split(e.section),r.removeEmptyElements(e.section),r.isNotEmpty(e.section.previousElementSibling)&&r.removeEmptyElements(e.section.previousElementSibling),t())};n.exports=function(){return function(e){return i(this)?void a(this,e):e()}}}),e.register("med/src/plugins/init-context.js",function(t,n){"use strict";var r=e("med/src/keyboard.js"),i=e("med/src/utils/index.js");n.exports=function(){return function(e){var t=this.event,n=t.keyCode||t.which,s=r.modifiers[n],a=this.editor;this.modifier=s,this.ctrl=t.ctrlKey,this.option=this.alt=t.altKey,this.shift=t.shiftKey,this.command=this.meta=t.metaKey,this.code=n,this.key=r.map[n]||String.fromCharCode(n),this.super=this[r.super],this.node=a.caret.focusNode(),this.element=a.caret.focusElement(),this.nextElement=a.caret.nextElement(),this.section=a.caret.focusSection(),this.paragraph=a.caret.focusParagraph(),this.paragraphs=a.caret.focusParagraphs(),this.figure=a.el.querySelector("figure.is-active"),this.detail=a.caret.focusDetail();var o=a.el.querySelectorAll('br[type="_med_placeholder"]');Array.prototype.forEach.call(o,function(e){i.removeElement(e)}),e()}}}),e.register("med/src/plugins/refocus.js",function(e,t){"use strict";t.exports=function(e){e.on("walkEnd",function(e){var t=e.focusTo,n=e.focusOffset;t&&e.editor.caret.select(t,n,t,n)})}}),e.register("med/src/plugins/remove-extra-nodes.js",function(t,n){"use strict";var r=e("med/src/utils/index.js");n.exports=function(e){var t=function(e){for(var t,n,i,s=e.element,a=e.editor.caret.focusElement(),o=s.childNodes,c=o.length,u=function(){return n&&n.nodeType===t.nodeType&&r.isAllowedToHaveContent(n)};c--;)t=o[c],n=o[c-1],u()&&(n===a&&(i=r.lastNode(a),e.focusTo=i,e.focusOffset=i.length),r.isTextNode(n)?n.appendData(t.data):r.isElementNode(n)&&r.moveChildNodes(t,n),t.parentNode.removeChild(t))};e.on("walk",function(e){r.isType("paragraph",e.element)&&t(e)})}}),e.register("med/src/plugins/remove-inline-style.js",function(e,t){"use strict";t.exports=function(e){e.on("walk",function(e){e.el.setAttribute("style","")})}}),e.register("med/src/plugins/rename-elements.js",function(e,t){"use strict";t.exports=function(e){e.on("walkStart",function(e){e.names={}}),e.on("walk",function(e){e.names[e.name]?e.el.setAttribute("name",""):e.names[e.name]=1})}}),e.register("med/src/utils/index.js",function(t,n){"use strict";var r=n.exports={};e("med/src/utils/node.js")(r),e("med/src/utils/others.js")(r),e("med/src/utils/schema.js")(r)}),e.register("med/src/utils/node.js",function(e,t){"use strict";t.exports=function(e){e.getTextContent=function(e){var t;if(!e)return"";switch(e.nodeType){case document.ELEMENT_NODE:t=e.textContent||e.innerText||"";break;case document.TEXT_NODE:t=e.data;break;default:t=""}return t},e.setNodeContent=function(t,n){e.isTextNode(t)?t.data=n:t.innerHTML=n},e.isEmpty=function(t){return e.isAllowedToHaveContent(t)?!e.getTextContent(t).trim():!1},e.isStrictEmpty=function(t){return e.isAllowedToHaveContent(t)?!t.innerHTML.trim():!1},e.isNotEmpty=function(t){return!e.isEmpty(t)},e.isNotStrictEmpty=function(t){return!e.isStrictEmpty(t)},e.isTag=function(e,t){if(!t)return!1;"string"==typeof e&&(e=[e]);var n=function(e){return e.toUpperCase()};return!!~e.map(n).indexOf(t.tagName)},e.isAllowedToHaveContent=function(t){return!e.isTag(["br","input","img"],t)},e.isLastChild=function(e){return e.parentELement.lastChild===e},e.removeEmptyElements=function(t){var n=function(t){return e.isType("paragraphs",t)&&e.isEmpty(t)},r=function(t){return e.isTag("p",t)&&e.isEmpty(t)&&!e.isFirstElementOf(t.parentElement,t)},i=function(t){return e.isType("paragraph",t)&&e.isStrictEmpty(t)};e.each(t.children,function(t){var s=n(t)||r(t)||i(t);s?e.removeElement(t):e.removeEmptyElements(t)})},e.removeElement=function(e){e.parentElement&&e.parentElement.removeChild(e)},e.moveChildren=function(t,n){var r=Array.prototype.slice.call(t.children);e.each(r,function(e){n.appendChild(e)})},e.moveChildNodes=function(t,n){var r=Array.prototype.slice.call(t.childNodes);e.each(r,function(e){n.appendChild(e)})},e.isType=function(t,n){var r=e.getElementSchema(n);return"string"==typeof t&&(t=[t]),r&&!!~t.indexOf(r.type)},e.isElementNode=function(e){return e&&e.nodeType===document.ELEMENT_NODE},e.isTextNode=function(e){return e&&e.nodeType===document.TEXT_NODE},e.isAncestorOf=function(t,n){var r=e.getParents(t);return!!~r.indexOf(n)},e.getParents=function(e){var t,n=[];if(!e)return n;for(;t=e.parentNode;)n.push(t),e=t;return n},e.nodeContentLength=function(t){return e.getTextContent(t).length},e.lastNode=function(e){return e&&e.childNodes[e.childNodes.length-1]},e.lastTextNode=function(t){if(!t)return null;if(e.isTextNode(t))return t;for(var n=Array.prototype.slice.call(t.childNodes);t=n.pop();)if(t=e.lastTextNode(t))return t;return null},e.lastElement=function(e){return e&&e.children[e.children.length-1]},e.firstNode=function(e){return e&&e.childNodes[0]},e.firstTextNode=function(t){if(!t)return null;if(e.isTextNode(t))return t;for(var n=Array.prototype.slice.call(t.childNodes);t=n.shift();)if(t=e.lastTextNode(t))return t;return null},e.firstElement=function(e){return e&&e.children[0]},e.isLastElementOf=function(t,n){var r=e.lastElement(t);return r===n},e.isFirstElementOf=function(t,n){var r=e.firstElement(t);return r===n}}}),e.register("med/src/utils/others.js",function(e,t){"use strict";t.exports=function(e){e.mixin=function(e,t){return Object.getOwnPropertyNames(t).forEach(function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r)}),e},e.preventDefault=function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1},e.os=function(){var e=navigator.userAgent;switch(!0){case/mac/i.test(e):return"mac";case/win/i.test(e):return"windows";case/linux/i.test(e):return"linux";default:return"unknown"}},e.each=function(t,n){return e.isArrayLike(t)&&Array.prototype.forEach.call(t,n),t},e.isArrayLike=function(e){return"object"==typeof e&&"number"==typeof e.length},e.split=function(e,t){var n=new RegExp("\\\\"+t,"g");return e.replace(n,"￿").split(t).map(function(e){return e.replace(/\uffff/g,t)})},e.clone=function(e){return JSON.parse(JSON.stringify(e))},e.equal=function(t,n){if(null===t||/^[sbn]/.test(typeof t))return t===n;if(t instanceof Array)return n instanceof Array?(t=t.slice().sort(),n=n.slice().sort(),t.join()===n.join()):!1;if("object"==typeof t){if("object"!=typeof n)return!1;var r,i;for(r in t)if(t.hasOwnProperty(r)&&(i=t.hasOwnProperty(r)&&n.hasOwnProperty(r)&&!e.equal(t[r],n[r])))return!1;return!0}return!1}}}),e.register("med/src/utils/schema.js",function(t,n){"use strict";var r=e("med/src/schema.js");n.exports=function(e){e.getType=function(t){var n=e.getElementSchema(t);return n?n.type:null},e.getElementSchema=function(e){return e&&r[e.tagName.toLowerCase()]||null}}}),"object"==typeof exports?module.exports=e("med"):"function"==typeof define&&define.amd?define([],function(){return e("med")}):this.Med=e("med")}();
//# sourceMappingURL=./dist/med.map